<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>Admin Panel - SearchZone</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ===== DARK THEME VARIABLES ===== */
        :root {
            --bg-primary: #0a0c10;
            --bg-secondary: #14181c;
            --bg-card: #1e2428;
            --bg-hover: #2a3138;
            --text-primary: #e4e6eb;
            --text-secondary: #b0b3b8;
            --text-muted: #8a8f99;
            --accent-primary: #6c5ce7;
            --accent-secondary: #a463f5;
            --accent-success: #00b894;
            --accent-warning: #fdcb6e;
            --accent-danger: #d63031;
            --border-color: #2d343e;
            --shadow-color: rgba(0, 0, 0, 0.5);
            
            /* Category Colors */
            --category-anime: #ff6b6b;
            --category-movies: #4ecdc4;
            --category-software: #a8e6cf;
            --category-books: #ffd93d;
            --category-games: #6c5ce7;
            --category-music: #ff9ff3;
            --category-other: #8395a7;

            /* Spacing */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 12px;
            --spacing-lg: 16px;
            --spacing-xl: 20px;
            --spacing-xxl: 24px;
            --spacing-xxxl: 32px;
            
            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            height: -webkit-fill-available;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            line-height: 1.5;
            padding: var(--spacing-lg);
            position: relative;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* ===== LOGIN OVERLAY ===== */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: var(--spacing-lg);
            overflow-y: auto;
        }

        .login-overlay.hidden {
            display: none;
        }

        .login-card {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xxxl);
            box-shadow: 0 20px 60px var(--shadow-color);
            max-width: 450px;
            width: 100%;
            margin: auto;
            border: 1px solid var(--border-color);
        }

        /* ===== ADMIN CONTENT ===== */
        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        /* ===== FIXED HEADER ACTIONS ===== */
        .header-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xxl);
            flex-wrap: wrap;
            gap: var(--spacing-md);
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-primary);
            padding: var(--spacing-md) 0;
        }

        .back-link, .logout-btn {
            background: var(--bg-card);
            color: var(--text-primary);
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--radius-full);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .logout-btn {
            background: var(--accent-danger);
            border-color: var(--accent-danger);
            color: white;
            cursor: pointer;
            border: none;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(214, 48, 49, 0.3);
        }

        .back-link:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .header-title {
            text-align: center;
            flex: 1;
        }

        .header-title h1 {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            background: linear-gradient(135deg, #6c5ce7, #a463f5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: var(--spacing-xs);
        }

        .header-title p {
            color: var(--text-secondary);
            font-size: clamp(0.85rem, 3vw, 1.1rem);
        }

        /* ===== CARDS ===== */
        .admin-card {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: clamp(var(--spacing-lg), 4vw, var(--spacing-xxxl));
            margin-bottom: var(--spacing-xxl);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .admin-card:hover {
            box-shadow: 0 12px 30px var(--shadow-color);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--accent-primary);
        }

        .card-header h3 {
            color: var(--text-primary);
            font-size: clamp(1.1rem, 4vw, 1.3rem);
            font-weight: 600;
        }

        /* ===== CATEGORY STATS GRID ===== */
        .category-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .category-stat-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border-left: 4px solid;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            border-left-width: 4px;
        }

        .category-stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px var(--shadow-color);
        }

        .category-stat-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        .category-stat-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            flex-shrink: 0;
        }

        .category-stat-number {
            font-size: clamp(1.3rem, 5vw, 1.8rem);
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .category-stat-label {
            color: var(--text-muted);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ===== FORM STYLES ===== */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-xl);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-group label {
            display: block;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.2);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-hint {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: var(--spacing-xs);
        }

        /* ===== CHECKBOX GROUP - OPTIMIZED ===== */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: var(--spacing-sm);
            padding: var(--spacing-lg);
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            margin-top: var(--spacing-xs);
            max-height: 300px;
            overflow-y: auto;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--bg-card);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .checkbox-item:hover {
            background: var(--bg-hover);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent-primary);
            flex-shrink: 0;
        }

        .checkbox-item label {
            margin-bottom: 0;
            cursor: pointer;
            flex: 1;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ===== BUTTON STYLES ===== */
        .btn {
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: 0.95rem;
            font-weight: 600;
            border: none;
            border-radius: var(--radius-full);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            transition: all 0.3s ease;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .btn i {
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6c5ce7, #a463f5);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(108, 92, 231, 0.3);
        }

        .btn-danger {
            background: var(--accent-danger);
            color: white;
            border: none;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
        }

        .btn-sm {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.85rem;
        }

        .btn-block {
            width: 100%;
        }

        /* ===== BULK ACTIONS ===== */
        .bulk-actions {
            display: flex;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            padding: var(--spacing-xl);
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            flex-wrap: wrap;
            border: 1px solid var(--border-color);
        }

        .bulk-actions select {
            flex: 1;
            min-width: 200px;
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        /* ===== FILTER BUTTONS ===== */
        .filter-buttons {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
            flex-wrap: wrap;
        }

        .filter-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-full);
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .filter-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        /* ===== TABLE - OPTIMIZED FOR MOBILE ===== */
        .table-responsive {
            overflow-x: auto;
            margin: 0 -var(--spacing-lg);
            padding: 0 var(--spacing-lg);
        }

        .archives-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .archives-table th {
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: var(--spacing-md) var(--spacing-lg);
            text-align: left;
            border-bottom: 2px solid var(--border-color);
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .archives-table td {
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.9rem;
            vertical-align: middle;
        }

        .archives-table tr:hover {
            background: var(--bg-hover);
        }

        /* Mobile card view for tables */
        @media (max-width: 768px) {
            .table-responsive {
                overflow-x: visible;
                margin: 0;
                padding: 0;
            }

            .archives-table {
                min-width: 100%;
                border: 0;
            }

            .archives-table thead {
                display: none;
            }

            .archives-table tbody tr {
                display: block;
                margin-bottom: var(--spacing-lg);
                background: var(--bg-secondary);
                border-radius: var(--radius-lg);
                border: 1px solid var(--border-color);
                padding: var(--spacing-lg);
            }

            .archives-table td {
                display: flex;
                align-items: center;
                gap: var(--spacing-md);
                padding: var(--spacing-sm) 0;
                border: none;
                border-bottom: 1px solid var(--border-color);
            }

            .archives-table td:last-child {
                border-bottom: none;
            }

            .archives-table td:before {
                content: attr(data-label);
                font-weight: 600;
                color: var(--text-primary);
                width: 100px;
                flex-shrink: 0;
            }

            .category-badges-container {
                max-width: 100%;
            }
        }

        /* ===== CATEGORY BADGES ===== */
        .category-badges-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            max-width: 300px;
        }

        .category-badge-table {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: var(--radius-full);
            font-size: 0.7rem;
            font-weight: 600;
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .category-badge-table i {
            font-size: 0.65rem;
        }

        .category-badge-table.anime { background: var(--category-anime); color: white; border-color: var(--category-anime); }
        .category-badge-table.movies { background: var(--category-movies); color: var(--bg-primary); border-color: var(--category-movies); }
        .category-badge-table.software { background: var(--category-software); color: var(--bg-primary); border-color: var(--category-software); }
        .category-badge-table.books { background: var(--category-books); color: var(--bg-primary); border-color: var(--category-books); }
        .category-badge-table.games { background: var(--category-games); color: white; border-color: var(--category-games); }
        .category-badge-table.music { background: var(--category-music); color: var(--bg-primary); border-color: var(--category-music); }
        .category-badge-table.other { background: var(--category-other); color: white; border-color: var(--category-other); }

        /* ===== MODAL - FIXED SCROLLING ISSUE ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10000;
            overflow-y: auto;
            padding: var(--spacing-lg);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: clamp(var(--spacing-xl), 5vw, var(--spacing-xxxl));
            max-width: 600px;
            width: 100%;
            margin: auto;
            border: 1px solid var(--border-color);
            box-shadow: 0 25px 50px var(--shadow-color);
            animation: modalSlideIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--accent-primary);
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 10;
        }

        .modal-header h3 {
            color: var(--text-primary);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--radius-full);
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            color: var(--accent-danger);
            background: rgba(214, 48, 49, 0.1);
        }

        .modal-body {
            margin-bottom: var(--spacing-xl);
        }

        .modal-footer {
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
            position: sticky;
            bottom: 0;
            background: var(--bg-card);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-color);
        }

        /* ===== TOAST NOTIFICATION ===== */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            left: 20px;
            z-index: 10001;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            pointer-events: none;
        }

        .toast {
            background: var(--bg-card);
            color: var(--text-primary);
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--radius-lg);
            margin-top: var(--spacing-sm);
            box-shadow: 0 10px 30px var(--shadow-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            border-left: 4px solid var(--accent-success);
            animation: slideInRight 0.3s ease;
            max-width: 350px;
            width: 100%;
            border: 1px solid var(--border-color);
            border-left-width: 4px;
            pointer-events: auto;
        }

        @media (max-width: 768px) {
            .toast {
                max-width: 100%;
            }
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xxxl) var(--spacing-xl);
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 3.5rem;
            margin-bottom: var(--spacing-lg);
            color: var(--text-muted);
        }

        .empty-state h3 {
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        /* ===== LOADING ===== */
        .loading {
            text-align: center;
            padding: var(--spacing-xxxl);
            color: var(--accent-primary);
        }

        .loading i {
            margin-right: var(--spacing-sm);
        }

        /* ===== UTILITY CLASSES ===== */
        .text-success { color: var(--accent-success); }
        .text-warning { color: var(--accent-warning); }
        .text-danger { color: var(--accent-danger); }
        .text-muted { color: var(--text-muted); }
        
        .mt-1 { margin-top: var(--spacing-sm); }
        .mt-2 { margin-top: var(--spacing-md); }
        .mt-3 { margin-top: var(--spacing-lg); }
        .mt-4 { margin-top: var(--spacing-xl); }
        
        .mb-1 { margin-bottom: var(--spacing-sm); }
        .mb-2 { margin-bottom: var(--spacing-md); }
        .mb-3 { margin-bottom: var(--spacing-lg); }
        .mb-4 { margin-bottom: var(--spacing-xl); }

        .w-100 { width: 100%; }
        .d-flex { display: flex; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: var(--spacing-sm); }
        .gap-2 { gap: var(--spacing-md); }
        .gap-3 { gap: var(--spacing-lg); }

        /* ===== RESPONSIVE BREAKPOINTS ===== */
        @media (max-width: 1024px) {
            body { padding: var(--spacing-md); }
            .admin-card { padding: var(--spacing-xl); }
        }

        @media (max-width: 768px) {
            body { padding: var(--spacing-sm); }
            
            .header-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .back-link, .logout-btn {
                width: 100%;
                justify-content: center;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .bulk-actions {
                flex-direction: column;
            }
            
            .bulk-actions select {
                width: 100%;
            }
            
            .modal-content {
                padding: var(--spacing-xl);
                margin: var(--spacing-md);
            }
        }

        @media (max-width: 480px) {
            .login-card { padding: var(--spacing-xl); }
            .admin-card { padding: var(--spacing-lg); }
            .category-stats-grid { grid-template-columns: 1fr; }
            .checkbox-group { grid-template-columns: 1fr; }
            .modal-content { padding: var(--spacing-lg); }
        }
    </style>
</head>
<body>
    <!-- Login Overlay -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-card">
            <div class="login-header" style="text-align: center; margin-bottom: var(--spacing-xxl);">
                <div class="login-icon" style="font-size: 3rem; color: var(--accent-primary); margin-bottom: var(--spacing-lg);">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h2 style="color: var(--text-primary); font-size: clamp(1.5rem, 6vw, 2rem); margin-bottom: var(--spacing-sm);">Admin Login</h2>
                <p style="color: var(--text-muted);">Enter your credentials to access admin panel</p>
            </div>

            <div id="loginError" class="error-message" style="display: none; background: rgba(214, 48, 49, 0.1); color: var(--accent-danger); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg); border-left: 4px solid var(--accent-danger);"></div>
            <div id="rateLimitWarning" class="rate-limit-warning" style="display: none; background: rgba(253, 203, 110, 0.1); color: var(--accent-warning); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg); border-left: 4px solid var(--accent-warning);"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input 
                        type="text" 
                        id="username" 
                        placeholder="Enter username"
                        autocomplete="username"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input 
                        type="password" 
                        id="password" 
                        placeholder="Enter password"
                        autocomplete="current-password"
                        required
                    >
                </div>

                <button type="submit" class="btn btn-primary btn-block" style="width: 100%;">
                    <i class="fas fa-lock-open"></i> Login
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Content -->
    <div class="admin-content" id="adminContent">
        <!-- Header Actions -->
        <div class="header-actions">
            <a href="serchzone.html" class="back-link">
                <i class="fas fa-arrow-left"></i> 
                <span class="hide-mobile">Back to Search</span>
                <span class="show-mobile" style="display: none;">Back</span>
            </a>
            
            <div class="header-title">
                <h1><i class="fas fa-cog"></i> Admin Panel</h1>
                <p>Manage archives with multi-category support</p>
            </div>
            
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> 
                <span class="hide-mobile">Logout</span>
                <span class="show-mobile" style="display: none;">Exit</span>
            </button>
        </div>

        <div class="container">
            <!-- Category Statistics -->
            <div class="admin-card">
                <div class="card-header">
                    <i class="fas fa-chart-pie" style="color: var(--accent-primary);"></i>
                    <h3>Category Overview</h3>
                </div>
                <div class="category-stats-grid" id="categoryStats"></div>
            </div>

            <!-- Add Archive Form -->
            <div class="admin-card">
                <div class="card-header">
                    <i class="fas fa-plus-circle" style="color: var(--accent-primary);"></i>
                    <h3>Add New Archive</h3>
                </div>
                
                <form id="addArchiveForm">
                    <div class="form-grid">
                        <div>
                            <div class="form-group">
                                <label for="archiveName">Archive Name *</label>
                                <input type="text" id="archiveName" placeholder="e.g., AnimeFlix, MoviesMod" required>
                            </div>

                            <div class="form-group">
                                <label for="archiveUrl">Website URL *</label>
                                <input type="text" id="archiveUrl" placeholder="e.g., animeflix.town" required>
                            </div>

                            <div class="form-group">
                                <label for="archiveSearchPattern">Search URL Pattern</label>
                                <input type="text" id="archiveSearchPattern" placeholder="/?s={query} or /search?q={query}">
                                <div class="form-hint">Use {query} as placeholder for search term</div>
                            </div>
                        </div>

                        <div>
                            <div class="form-group">
                                <label>Categories * (select one or more)</label>
                                <div class="checkbox-group" id="categoryCheckboxes"></div>
                                <div class="form-hint">Select all categories that apply to this archive</div>
                            </div>

                            <div class="form-group">
                                <label for="archiveDescription">Description</label>
                                <textarea id="archiveDescription" placeholder="What content can users find here?"></textarea>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: flex-end; margin-top: var(--spacing-xl);">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus-circle"></i> Add Archive
                        </button>
                    </div>
                </form>
            </div>

            <!-- Bulk Category Management -->
            <div class="admin-card">
                <div class="card-header">
                    <i class="fas fa-tags" style="color: var(--accent-primary);"></i>
                    <h3>Bulk Category Management</h3>
                </div>
                
                <div class="bulk-actions">
                    <select id="bulkCategorySelect" class="category-select">
                        <option value="">Select category to add/remove</option>
                        <option value="anime">üé¨ Anime</option>
                        <option value="movies">üé• Movies & TV</option>
                        <option value="software">üíª Software</option>
                        <option value="books">üìö Books & Comics</option>
                        <option value="games">üéÆ Games</option>
                        <option value="music">üéµ Music</option>
                        <option value="other">üì¶ Other</option>
                    </select>
                    
                    <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="addBulkCategory()">
                            <i class="fas fa-plus"></i> Add
                        </button>
                        <button class="btn btn-danger" onclick="removeBulkCategory()">
                            <i class="fas fa-minus"></i> Remove
                        </button>
                        <button class="btn btn-secondary" onclick="selectAllArchives()">
                            <i class="fas fa-check-square"></i> Select All
                        </button>
                    </div>
                </div>
            </div>

            <!-- Archives Management -->
            <div class="admin-card">
                <div class="card-header">
                    <i class="fas fa-list" style="color: var(--accent-primary);"></i>
                    <h3>Manage Archives</h3>
                </div>
                
                <!-- Category Filter -->
                <div class="filter-buttons">
                    <button class="filter-btn" onclick="filterArchivesByCategory('all')">
                        <i class="fas fa-globe"></i> All
                    </button>
                    <button class="filter-btn" onclick="filterArchivesByCategory('anime')">
                        <i class="fas fa-tv" style="color: var(--category-anime);"></i> Anime
                    </button>
                    <button class="filter-btn" onclick="filterArchivesByCategory('movies')">
                        <i class="fas fa-film" style="color: var(--category-movies);"></i> Movies
                    </button>
                    <button class="filter-btn" onclick="filterArchivesByCategory('software')">
                        <i class="fas fa-code" style="color: var(--category-software);"></i> Software
                    </button>
                    <button class="filter-btn" onclick="filterArchivesByCategory('books')">
                        <i class="fas fa-book" style="color: var(--category-books);"></i> Books
                    </button>
                    <button class="filter-btn" onclick="filterArchivesByCategory('games')">
                        <i class="fas fa-gamepad" style="color: var(--category-games);"></i> Games
                    </button>
                    <button class="filter-btn" onclick="filterArchivesByCategory('music')">
                        <i class="fas fa-music" style="color: var(--category-music);"></i> Music
                    </button>
                </div>

                <!-- Archives Table -->
                <div id="archivesTableContainer">
                    <div class="table-responsive">
                        <table class="archives-table" id="archivesTable">
                            <thead>
                                <tr>
                                    <th style="width: 40px;">
                                        <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll(this)">
                                    </th>
                                    <th>Name</th>
                                    <th>URL</th>
                                    <th>Categories</th>
                                    <th>Search Pattern</th>
                                    <th style="width: 120px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="archivesTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Archive Modal - FIXED SCROLLING ISSUE -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit" style="color: var(--accent-primary);"></i> Edit Archive</h3>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="editArchiveForm">
                    <input type="hidden" id="editOriginalUrl">
                    
                    <div class="form-group">
                        <label for="editName">Archive Name *</label>
                        <input type="text" id="editName" required>
                    </div>

                    <div class="form-group">
                        <label for="editUrl">Website URL *</label>
                        <input type="text" id="editUrl" required>
                    </div>

                    <div class="form-group">
                        <label>Categories * (select one or more)</label>
                        <div class="checkbox-group" id="editCategoryCheckboxes" style="max-height: 250px;"></div>
                    </div>

                    <div class="form-group">
                        <label for="editSearchPattern">Search Pattern</label>
                        <input type="text" id="editSearchPattern" placeholder="/?s={query}">
                    </div>

                    <div class="form-group">
                        <label for="editDescription">Description</label>
                        <textarea id="editDescription" rows="3"></textarea>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeEditModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="submit" form="editArchiveForm" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script>
        // ============================================
        // TOAST NOTIFICATION
        // ============================================
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            toast.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <div style="flex: 1;">${message}</div>
                <i class="fas fa-times" style="cursor: pointer; opacity: 0.7; margin-left: var(--spacing-sm);" onclick="this.parentElement.remove()"></i>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 4000);
        }

        // ============================================
        // AUTHENTICATION & RATE LIMITING
        // ============================================
        
        const ADMIN_CREDENTIALS = {
            username: 'idiot-ghost3948',
            password: 'deepaks2727e888'
        };

        const MAX_LOGIN_ATTEMPTS = 5;
        const LOCKOUT_DURATION = 15 * 60 * 1000;
        const SESSION_DURATION = 2 * 60 * 60 * 1000;

        function isAuthenticated() {
            const session = JSON.parse(localStorage.getItem('adminSession') || 'null');
            if (!session) return false;
            return Date.now() < session.expiry;
        }

        function getLoginAttempts() {
            return JSON.parse(localStorage.getItem('loginAttempts') || '{"count": 0, "lockoutUntil": null}');
        }

        function saveLoginAttempts(data) {
            localStorage.setItem('loginAttempts', JSON.stringify(data));
        }

        function isAccountLocked() {
            const attempts = getLoginAttempts();
            if (attempts.lockoutUntil && Date.now() < attempts.lockoutUntil) {
                return {
                    locked: true,
                    remainingTime: Math.ceil((attempts.lockoutUntil - Date.now()) / 60000)
                };
            }
            return { locked: false };
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const lockStatus = isAccountLocked();
            if (lockStatus.locked) {
                const errorEl = document.getElementById('loginError');
                errorEl.textContent = `üîí Account locked. Try again in ${lockStatus.remainingTime} minutes.`;
                errorEl.style.display = 'block';
                return;
            }

            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                saveLoginAttempts({ count: 0, lockoutUntil: null });
                
                const session = {
                    expiry: Date.now() + SESSION_DURATION
                };
                localStorage.setItem('adminSession', JSON.stringify(session));
                
                document.getElementById('loginOverlay').classList.add('hidden');
                document.getElementById('adminContent').classList.add('active');
                
                initializeAdmin();
                showToast('Login successful!', 'success');
            } else {
                const attempts = getLoginAttempts();
                attempts.count += 1;

                const errorEl = document.getElementById('loginError');
                
                if (attempts.count >= MAX_LOGIN_ATTEMPTS) {
                    attempts.lockoutUntil = Date.now() + LOCKOUT_DURATION;
                    errorEl.textContent = `üîí Too many failed attempts! Account locked for 15 minutes.`;
                } else {
                    const attemptsLeft = MAX_LOGIN_ATTEMPTS - attempts.count;
                    errorEl.textContent = `‚ùå Invalid username or password! ${attemptsLeft} attempts remaining.`;
                }
                
                errorEl.style.display = 'block';
                saveLoginAttempts(attempts);
                document.getElementById('password').value = '';
            }
        });

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('adminSession');
                location.reload();
            }
        }

        // Check authentication on load
        window.addEventListener('DOMContentLoaded', function() {
            if (isAuthenticated()) {
                document.getElementById('loginOverlay').classList.add('hidden');
                document.getElementById('adminContent').classList.add('active');
                initializeAdmin();
            }
            
            // Handle mobile view classes
            if (window.innerWidth <= 768) {
                document.querySelectorAll('.hide-mobile').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.show-mobile').forEach(el => el.style.display = 'inline');
            }
        });

        // Handle resize for mobile view
        window.addEventListener('resize', function() {
            if (window.innerWidth <= 768) {
                document.querySelectorAll('.hide-mobile').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.show-mobile').forEach(el => el.style.display = 'inline');
            } else {
                document.querySelectorAll('.hide-mobile').forEach(el => el.style.display = 'inline');
                document.querySelectorAll('.show-mobile').forEach(el => el.style.display = 'none');
            }
        });

        // ============================================
        // CATEGORY MANAGEMENT
        // ============================================
        
        const CATEGORIES = [
            { id: 'anime', name: 'Anime', icon: 'fas fa-tv', color: '#ff6b6b' },
            { id: 'movies', name: 'Movies & TV', icon: 'fas fa-film', color: '#4ecdc4' },
            { id: 'software', name: 'Software', icon: 'fas fa-code', color: '#a8e6cf' },
            { id: 'books', name: 'Books & Comics', icon: 'fas fa-book', color: '#ffd93d' },
            { id: 'games', name: 'Games', icon: 'fas fa-gamepad', color: '#6c5ce7' },
            { id: 'music', name: 'Music', icon: 'fas fa-music', color: '#ff9ff3' },
            { id: 'other', name: 'Other', icon: 'fas fa-archive', color: '#8395a7' }
        ];

        let currentFilter = 'all';
        let selectedArchives = new Set();

        // Load archives from localStorage
        function loadArchives() {
            const archives = JSON.parse(localStorage.getItem('archives') || '[]');
            
            // Migrate old format
            let updated = false;
            archives.forEach(archive => {
                if (archive.category && !archive.categories) {
                    archive.categories = [archive.category];
                    delete archive.category;
                    updated = true;
                }
                if (!archive.categories) {
                    archive.categories = ['other'];
                    updated = true;
                }
                if (!archive.searchPattern) {
                    archive.searchPattern = '/?s={query}';
                    updated = true;
                }
            });
            
            if (updated) {
                localStorage.setItem('archives', JSON.stringify(archives));
            }

            return archives;
        }

        // Save archives to localStorage
        function saveArchives(archives) {
            localStorage.setItem('archives', JSON.stringify(archives));
        }

        // Initialize category checkboxes
        function initializeCategoryCheckboxes() {
            const container = document.getElementById('categoryCheckboxes');
            if (container) {
                container.innerHTML = CATEGORIES.map(cat => `
                    <div class="checkbox-item">
                        <input type="checkbox" id="cat_${cat.id}" value="${cat.id}">
                        <label for="cat_${cat.id}">
                            <i class="${cat.icon}" style="color: ${cat.color};"></i> ${cat.name}
                        </label>
                    </div>
                `).join('');
            }

            const editContainer = document.getElementById('editCategoryCheckboxes');
            if (editContainer) {
                editContainer.innerHTML = CATEGORIES.map(cat => `
                    <div class="checkbox-item">
                        <input type="checkbox" id="edit_cat_${cat.id}" value="${cat.id}">
                        <label for="edit_cat_${cat.id}">
                            <i class="${cat.icon}" style="color: ${cat.color};"></i> ${cat.name}
                        </label>
                    </div>
                `).join('');
            }
        }

        // Get selected categories
        function getSelectedCategories(prefix = '') {
            const selected = [];
            CATEGORIES.forEach(cat => {
                const checkbox = document.getElementById(`${prefix}cat_${cat.id}`);
                if (checkbox && checkbox.checked) {
                    selected.push(cat.id);
                }
            });
            return selected;
        }

        // Set selected categories
        function setSelectedCategories(categories, prefix = '') {
            CATEGORIES.forEach(cat => {
                const checkbox = document.getElementById(`${prefix}cat_${cat.id}`);
                if (checkbox) checkbox.checked = false;
            });
            
            if (categories && Array.isArray(categories)) {
                categories.forEach(catId => {
                    const checkbox = document.getElementById(`${prefix}cat_${catId}`);
                    if (checkbox) checkbox.checked = true;
                });
            }
        }

        // Display category statistics
        function displayCategoryStats() {
            const archives = loadArchives();
            const container = document.getElementById('categoryStats');
            if (!container) return;
            
            const stats = CATEGORIES.map(category => {
                const count = archives.filter(a => 
                    a.categories && a.categories.includes(category.id)
                ).length;
                return { ...category, count };
            });

            container.innerHTML = stats.map(stat => `
                <div class="category-stat-card" style="border-left-color: ${stat.color};">
                    <div class="category-stat-header">
                        <div class="category-stat-icon" style="background: ${stat.color};">
                            <i class="${stat.icon}"></i>
                        </div>
                        <div>
                            <div class="category-stat-number">${stat.count}</div>
                            <div class="category-stat-label">Archives</div>
                        </div>
                    </div>
                    <div style="color: var(--text-primary); font-weight: 600; font-size: 0.9rem;">
                        ${stat.name}
                    </div>
                </div>
            `).join('');
        }

        // Display archives in table
        function displayArchives() {
            const archives = loadArchives();
            let filteredArchives = archives;
            
            if (currentFilter !== 'all') {
                filteredArchives = archives.filter(a => 
                    a.categories && a.categories.includes(currentFilter)
                );
            }
            
            const tableContainer = document.getElementById('archivesTableContainer');

            if (filteredArchives.length === 0) {
                tableContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÇ</div>
                        <h3>No Archives Found</h3>
                        <p style="color: var(--text-muted);">${currentFilter === 'all' ? 'Add your first archive using the form above!' : `No archives in this category`}</p>
                    </div>
                `;
                return;
            }

            let html = '';
            
            filteredArchives.forEach((archive, index) => {
                const isSelected = selectedArchives.has(archive.url);
                
                const categoryBadges = (archive.categories || ['other']).map(catId => {
                    const category = CATEGORIES.find(c => c.id === catId) || CATEGORIES[6];
                    return `
                        <span class="category-badge-table ${catId}">
                            <i class="${category.icon}"></i> ${category.name}
                        </span>
                    `;
                }).join('');
                
                html += `<tr>
                    <td data-label="Select">
                        <input type="checkbox" class="archive-checkbox" data-url="${archive.url}" ${isSelected ? 'checked' : ''} onchange="toggleArchiveSelection('${archive.url}', this.checked)">
                    </td>
                    <td data-label="Name"><strong>${escapeHtml(archive.name)}</strong></td>
                    <td data-label="URL">${escapeHtml(archive.url)}</td>
                    <td data-label="Categories">
                        <div class="category-badges-container">
                            ${categoryBadges}
                        </div>
                    </td>
                    <td data-label="Search Pattern">
                        <code style="background: var(--bg-card); padding: 4px 8px; border-radius: 4px;">${escapeHtml(archive.searchPattern || '/?s={query}')}</code>
                    </td>
                    <td data-label="Actions">
                        <div style="display: flex; gap: var(--spacing-sm);">
                            <button class="btn btn-primary btn-sm" onclick="editArchive('${archive.url}')" style="padding: var(--spacing-sm) var(--spacing-md);">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteArchive('${archive.url}')" style="padding: var(--spacing-sm) var(--spacing-md);">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>`;
            });
            
            tableContainer.innerHTML = `
                <div class="table-responsive">
                    <table class="archives-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll(this)"></th>
                                <th>Name</th>
                                <th>URL</th>
                                <th>Categories</th>
                                <th>Search Pattern</th>
                                <th style="width: 120px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="archivesTableBody">${html}</tbody>
                    </table>
                </div>
            `;
            
            displayCategoryStats();
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Add new archive
        document.getElementById('addArchiveForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const name = document.getElementById('archiveName').value.trim();
            let url = document.getElementById('archiveUrl').value.trim();
            url = url.replace(/^https?:\/\//, '').replace(/\/$/, '');
            const categories = getSelectedCategories();
            const searchPattern = document.getElementById('archiveSearchPattern').value.trim();
            const description = document.getElementById('archiveDescription').value.trim();

            if (!name || !url) {
                showToast('Please fill in all required fields!', 'error');
                return;
            }

            if (categories.length === 0) {
                showToast('Please select at least one category!', 'error');
                return;
            }

            const archives = loadArchives();
            
            if (archives.some(a => a.url === url)) {
                showToast('This URL already exists!', 'error');
                return;
            }

            archives.push({
                name: name,
                url: url,
                categories: categories,
                searchPattern: searchPattern || '/?s={query}',
                description: description,
                addedDate: new Date().toISOString()
            });

            saveArchives(archives);
            displayArchives();
            
            this.reset();
            CATEGORIES.forEach(cat => {
                const cb = document.getElementById(`cat_${cat.id}`);
                if (cb) cb.checked = false;
            });
            
            showToast(`‚úÖ "${name}" added successfully!`, 'success');
        });

        // Delete archive
        function deleteArchive(url) {
            const archives = loadArchives();
            const archive = archives.find(a => a.url === url);
            
            if (confirm(`Are you sure you want to delete "${archive?.name}"?`)) {
                const filtered = archives.filter(a => a.url !== url);
                saveArchives(filtered);
                displayArchives();
                selectedArchives.delete(url);
                showToast(`üóëÔ∏è "${archive?.name}" deleted`, 'info');
            }
        }

        // Edit archive - FIXED SCROLLING ISSUE
        function editArchive(url) {
            const archives = loadArchives();
            const archive = archives.find(a => a.url === url);
            
            if (!archive) return;
            
            document.getElementById('editOriginalUrl').value = archive.url;
            document.getElementById('editName').value = archive.name;
            document.getElementById('editUrl').value = archive.url;
            document.getElementById('editSearchPattern').value = archive.searchPattern || '';
            document.getElementById('editDescription').value = archive.description || '';
            
            setSelectedCategories(archive.categories || ['other'], 'edit_');
            
            // Show modal and prevent body scroll
            const modal = document.getElementById('editModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close edit modal - FIXED SCROLLING ISSUE
        function closeEditModal() {
            const modal = document.getElementById('editModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Save edit form
        document.getElementById('editArchiveForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const originalUrl = document.getElementById('editOriginalUrl').value;
            const name = document.getElementById('editName').value.trim();
            let url = document.getElementById('editUrl').value.trim();
            url = url.replace(/^https?:\/\//, '').replace(/\/$/, '');
            const categories = getSelectedCategories('edit_');
            const searchPattern = document.getElementById('editSearchPattern').value.trim();
            const description = document.getElementById('editDescription').value.trim();
            
            if (!name || !url) {
                showToast('Please fill in all required fields!', 'error');
                return;
            }
            
            if (categories.length === 0) {
                showToast('Please select at least one category!', 'error');
                return;
            }
            
            const archives = loadArchives();
            const index = archives.findIndex(a => a.url === originalUrl);
            
            if (index === -1) return;
            
            if (url !== originalUrl && archives.some(a => a.url === url)) {
                showToast('This URL already exists!', 'error');
                return;
            }
            
            archives[index] = {
                ...archives[index],
                name: name,
                url: url,
                categories: categories,
                searchPattern: searchPattern || '/?s={query}',
                description: description
            };
            
            saveArchives(archives);
            displayArchives();
            closeEditModal();
            showToast(`‚úÖ "${name}" updated successfully!`, 'success');
        });

        // Filter archives by category
        function filterArchivesByCategory(categoryId) {
            currentFilter = categoryId;
            displayArchives();
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event?.target?.classList.add('active');
            
            const category = CATEGORIES.find(c => c.id === categoryId);
            showToast(`Showing ${category ? category.name : 'all'} archives`, 'info');
        }

        // Bulk add category
        function addBulkCategory() {
            const category = document.getElementById('bulkCategorySelect').value;
            
            if (!category) {
                showToast('Please select a category', 'warning');
                return;
            }
            
            if (selectedArchives.size === 0) {
                showToast('No archives selected', 'warning');
                return;
            }

            if (!confirm(`Add "${CATEGORIES.find(c => c.id === category)?.name}" category to ${selectedArchives.size} archive(s)?`)) {
                return;
            }

            const archives = loadArchives();
            archives.forEach(archive => {
                if (selectedArchives.has(archive.url)) {
                    if (!archive.categories) {
                        archive.categories = [];
                    }
                    if (!archive.categories.includes(category)) {
                        archive.categories.push(category);
                    }
                }
            });

            saveArchives(archives);
            displayArchives();
            showToast(`‚úÖ Category added to ${selectedArchives.size} archives`, 'success');
        }

        // Bulk remove category
        function removeBulkCategory() {
            const category = document.getElementById('bulkCategorySelect').value;
            
            if (!category) {
                showToast('Please select a category', 'warning');
                return;
            }
            
            if (selectedArchives.size === 0) {
                showToast('No archives selected', 'warning');
                return;
            }

            if (!confirm(`Remove "${CATEGORIES.find(c => c.id === category)?.name}" category from ${selectedArchives.size} archive(s)?`)) {
                return;
            }

            const archives = loadArchives();
            archives.forEach(archive => {
                if (selectedArchives.has(archive.url) && archive.categories) {
                    archive.categories = archive.categories.filter(c => c !== category);
                    if (archive.categories.length === 0) {
                        archive.categories = ['other'];
                    }
                }
            });

            saveArchives(archives);
            displayArchives();
            showToast(`‚úÖ Category removed from ${selectedArchives.size} archives`, 'success');
        }

        // Selection functions
        function toggleArchiveSelection(url, selected) {
            if (selected) {
                selectedArchives.add(url);
            } else {
                selectedArchives.delete(url);
            }
            updateSelectAllCheckbox();
        }

        function selectAllArchives() {
            const checkboxes = document.querySelectorAll('.archive-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = true;
                selectedArchives.add(cb.dataset.url);
            });
            const selectAll = document.getElementById('selectAllCheckbox');
            if (selectAll) selectAll.checked = true;
        }

        function toggleSelectAll(checkbox) {
            const checkboxes = document.querySelectorAll('.archive-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = checkbox.checked;
                if (checkbox.checked) {
                    selectedArchives.add(cb.dataset.url);
                } else {
                    selectedArchives.delete(cb.dataset.url);
                }
            });
        }

        function updateSelectAllCheckbox() {
            const checkboxes = document.querySelectorAll('.archive-checkbox');
            const selectAll = document.getElementById('selectAllCheckbox');
            if (selectAll) {
                selectAll.checked = checkboxes.length > 0 && Array.from(checkboxes).every(cb => cb.checked);
            }
        }

        // Initialize admin panel
        function initializeAdmin() {
            initializeCategoryCheckboxes();
            displayArchives();
            displayCategoryStats();
            selectedArchives.clear();
        }

        // Close modal on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeEditModal();
            }
        });

        // Close modal when clicking outside
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditModal();
            }
        });
    </script>
</body>
</html>